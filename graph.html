<!DOCTYPE html>
<html>

<head>
    <title>Dnscap Web Interface</title>
</head>

<body>
    <div>
        <p>Total Requests: <span id="total_requests"></span>
            <br> Recent Requests: <span id="recent_requests"></span>
            <br> CPU Usage: <span id="cpu_usage"></span>
            <br> Free Memory: <span id="free_mem"></span>
            <br> Interface 1: <span id="interface_1"></span>
            <br> Interface 2: <span id="interface_2"></span>
            <br> Interface 3: <span id="interface_3"></span>

            <br>
        </p>
    </div>
    <div style="height: 50%;width: 90%">
        <canvas id="myChart"></canvas>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
    <script type="text/javascript">
        var chart;
        var timer = 2000;
        $(document).ready(function() {
            var labelArr = [];
            for (var i = 0; i < 20; i++)
                labelArr.push((i * timer) / 1000);
            var ctx = document.getElementById('myChart').getContext('2d');
            chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'line',

                // The data for our dataset
                data: {
                    labels: labelArr,
                    datasets: [{
                        label: "Total DNS Packets Sniffed",
                        data: [],
                        borderColor: "#3e95cd",
                        fill: false
                    }, {
                        label: "Interface 1",
                        data: [],
                        borderColor: "#8e5ea2",
                        fill: false
                    }, {
                        label: "Interface 2",
                        data: [],
                        borderColor: "#3cba9f",
                        fill: false
                    }, {
                        label: "Interface 3",
                        data: [],
                        borderColor: "#c45850",
                        fill: false
                    }]
                },

                // Configuration options go here
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                suggestedMin: 0
                            }
                        }],
                    }
                }
            });
            setInterval(update, timer);
        });

        var update = function() {
            $.ajax({
                url: '/update',
                method: 'get',
                dataType: 'json',
                success: function(resp) {
                    if (resp) {
                        $('#recent_requests').text(resp.recentRequests);
                        $('#total_requests').text(resp.totalRequests);
                        for (var i = 0; i < 3; i++)
                            $('#interface_' + (i + 1).toString()).text(resp.total_interface[i]);
                        $('#cpu_usage').text((resp.cpuUsage * 100) + '%');
                        $('#free_mem').text(resp.freeMemory);
                        if (chart.data.datasets[0].data.length >= 20) {
                            chart.data.datasets[0].data.shift();
                            chart.data.datasets[0].data.push(resp.recentRequests);
                            for (var i = 0; i < 3; i++) {
                                chart.data.datasets[i + 1].data.shift();
                                chart.data.datasets[i + 1].data.push(resp.recent_interface[i]);
                            }
                        } else {
                            chart.data.datasets[0].data.push(resp.recentRequests)
                            for (var i = 0; i < 3; i++)
                                chart.data.datasets[i + 1].data.push(resp.recent_interface[i]);
                        }
                        chart.update();
                    }
                }
            });
        };
    </script>
</body>

</html>
